<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<!-- se define el nombre del fragmento -->
<div th:fragment="tarjetaPublicacion(dtopubli)" class="publicacion">

    <h2 th:text="${dtopubli.nombreUsuario + ' ' + dtopubli.apellidoUsuario}"></h2>
    <p class="texto" th:text="${dtopubli.descripcion}"></p>

    <!-- Formulario para dar like -->
    <form method="POST" th:action="@{/publicacion/darLike/{id}(id=${dtopubli.id})}">
        <button type="submit">
            <img class="user2" th:src="@{/imagenes/like.png}" alt="Like" />
        </button>
        <span th:text="${dtopubli.cantLikes}"></span>
    </form>

    <!-- Botón para mostrar comentarios -->
    <button type="button" class="verComentariosBtn">Ver Comentarios</button>

    <!-- Contenedor de comentarios oculto inicialmente -->
    <div class="contenedor_comentarios" style="display: none;">
        <!-- Lista de comentarios -->
        <div th:each="comentario : ${dtopubli.comentarios}" class="comentario">
            <strong th:text="${comentario.nombreUsuario + ' ' + comentario.apellidoUsuario}"></strong>
            <p th:text="${comentario.texto}"></p>
        </div>
    </div>

    <!-- Botón para mostrar formulario de comentario -->
    <button type="button" class="comentarBtn">
        <img class="user2" th:src="@{/imagenes/comentar.png}" alt="Comentar" />
    </button>

    <!-- Formulario para comentar -->
    <form method="POST" th:action="@{/publicacion/comentar/{id}(id=${dtopubli.id})}" class="formComentario" style="display: none;">
        <textarea name="texto" rows="3" cols="40" placeholder="Escribe tu comentario..."></textarea>
        <br/>
        <button type="submit">Enviar</button>
    </form>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Mostrar comentarios
            document.querySelectorAll(".verComentariosBtn").forEach(function (btn) {
                btn.addEventListener("click", function () {
                    const contenedor = btn.parentElement.querySelector(".contenedor_comentarios");
                    contenedor.style.display = contenedor.style.display === "none" ? "block" : "none";
                });
            });

            // Mostrar formulario para comentar
            document.querySelectorAll(".comentarBtn").forEach(function (btn) {
                btn.addEventListener("click", function () {
                    const form = btn.parentElement.querySelector(".formComentario");
                    form.style.display = "block";
                    form.querySelector("textarea").focus();
                });
            });
        });
    </script>


</div>


</body>
</html>
