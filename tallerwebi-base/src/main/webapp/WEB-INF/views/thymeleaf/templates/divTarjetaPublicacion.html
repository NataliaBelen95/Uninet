<<<<<<< HEAD
<div th:fragment="tarjetaPublicacion(dtopubli)" th:id="'publicacion-' + ${dtopubli.id}" xmlns:th="http://www.w3.org/1999/xhtml">
    <article class="estructura">
=======
<article th:if="${dtopubli != null}"
         th:fragment="tarjetaPublicacion(dtopubli, usuario)"
         class="estructura"
         th:id="'publicacion-' + ${dtopubli.id}"
         xmlns:th="http://www.w3.org/1999/xhtml">

>>>>>>> origin/pruebaDos
        <!-- Usuario -->
        <h2 th:text="${dtopubli.nombreUsuario + ' ' + dtopubli.apellidoUsuario}"></h2>

    <form th:if="${dtopubli != null and usuario != null and dtopubli.usuarioId.equals(usuario.id)}"
          th:action="@{/publicacion/eliminar/{id}(id=${dtopubli.id})}"
          method="post">
        <button class="delete-button" type="submit">
            <img th:src="@{/imagenes/borrarParaSiempre.png}" alt="deleteLogo" class="delete-logo"/>
        </button>
    </form>


        <!-- Mostrar descripción solo si existe -->
        <p class="texto" th:if="${dtopubli.descripcion != null and !#strings.isEmpty(dtopubli.descripcion)}" th:text="${dtopubli.descripcion}"></p>

        <!-- Mostrar archivo si hay -->
        <div th:if="${dtopubli.archivoNombre != null}">
            <div th:switch="${dtopubli.archivoTipo}">

                <!-- Mostrar imágenes -->
                <img th:case="'image/jpeg'" th:src="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}"
                     style="max-width: 200px; max-height: 200px;" alt="Imagen" />
                <img th:case="'image/png'" th:src="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}"
                     style="max-width: 200px; max-height: 200px;" alt="Imagen" />

                <!-- PDF -->
                <div th:case="'application/pdf'" class="archivo-pdf" style="margin-top: 10px;">
<!--                    <p>-->
<!--                        &#128196; <strong>Archivo:</strong>-->
<!--                        <span th:text="${#strings.substringAfter(dtopubli.archivoNombre, '_')}">nombre.pdf</span>-->
<!--                    </p>-->

                    <div class="acciones-archivo">
                        <a th:href="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}"
                           class="boton-descargar"
                           download>&#128229; Descargar PDF</a>

                        <button type="button"
                                class="ver-pdf-btn"
                                th:data-id="${dtopubli.id}"
                                th:data-url="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}">
                            &#128065; Ver PDF
                        </button>
                    </div>

                    <div th:attr="id='pdf-container-' + ${dtopubli.id}" class="pdf-container" style="display: none;">
                        <canvas th:attr="id='pdf-viewer-' + ${dtopubli.id}"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fecha -->
        <span th:text="${dtopubli.fechaPublicacion != null
                        ? dtopubli.fechaPublicacion.format(T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy HH:mm'))
                        : 'Sin fecha'}"></span>

        <!-- Contador de likes y comentarios -->
        <div class="contenedor_verComentarios">
            <div class="like-container">
                <img th:src="@{/imagenes/like.png}" alt="Like" style="width:20px;" />
                <span th:text="${dtopubli.cantLikes}" th:id="'likes-' + ${dtopubli.id}"></span>
            </div>

            <button class="botones_acciones ver-comentariosBtn"
                    type="button"
                    th:attr="data-id=${dtopubli.id}"
                    th:text="${dtopubli.cantComentarios == 0 ? 'No hay comentarios'
                      : (dtopubli.cantComentarios == 1 ? '1 comentario'
                      : dtopubli.cantComentarios + ' comentarios')}">
            </button>
        </div>

        <hr class="linea-divisora"/>

        <!-- Botonera de interacción -->
        <div class="botonera-publicacion">
            <section class="btns_interaccion_publicacion">
                <!-- Botón dar like -->
                <button class="botones_acciones likeBtn" type="button" th:data-id="${dtopubli.id}">
                    <img th:src="@{/imagenes/like.png}" alt="Like" th:id="'like-img-' + ${dtopubli.id}" />
                </button>

                <!-- Botón comentar -->
                <button class="botones_acciones comentarBtn" type="button" th:data-id="${dtopubli.id}">
                    <img th:src="@{/imagenes/comentar.png}" alt="Comentar" />
                </button>


                <!-- Formulario de comentar (oculto) -->
                <div class="contenedor_comentar" th:id="'contenedor-comentar-' + ${dtopubli.id}" style="display:none;">
                    <form th:id="'form-comentario-' + ${dtopubli.id}"
                          method="POST"
                          th:action="@{/publicacion/comentar/{id}(id=${dtopubli.id})}"
                          class="box_comentario formComentario">
                        <textarea name="texto" rows="3" placeholder="Escribe tu comentario..."></textarea>
                        <div class="box_publi_botones">
                            <button type="submit">Enviar</button>
                        </div>
                    </form>
                </div>
            </section>
        </div>

        <!-- Contenedor de comentarios -->
        <div class="contenedor_comentarios"
             th:id="'contenedor-comentarios-' + ${dtopubli.id}"
             style="display: none;">
            <div th:each="comentario : ${dtopubli.comentarios}" class="comentario">
                <strong th:text="${comentario.nombreUsuario + ' ' + comentario.apellidoUsuario}"></strong>
                <p th:text="${comentario.texto}"></p>
            </div>
        </div>
    </article>
</div>
