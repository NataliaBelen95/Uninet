<article th:if="${dtopubli != null}"
         th:fragment="tarjetaPublicacion(dtopubli, usuario)"
         class="estructura"
         th:id="'publicacion-' + ${dtopubli.id}"
         xmlns:th="http://www.w3.org/1999/xhtml">

    <div th:if="${dtopubli.esPublicidad}" style="background-color: #ffe0b2; padding: 5px 10px; border-radius: 5px; margin-bottom: 10px;">
        <span style="font-weight: bold; color: #e65100;">ANUNCIO DIRIGIDO</span>
    </div>

    <h2 th:if="${dtopubli.esPropio}">
        <a th:href="@{/miPerfil}"
           th:text="${dtopubli.autor.nombre + ' ' + dtopubli.autor.apellido}"></a>
    </h2>

    <h2 th:unless="${dtopubli.esPropio}">
        <a th:href="@{${dtopubli.autor.url}}"
           th:text="${dtopubli.autor.nombre + ' ' + dtopubli.autor.apellido}"></a>
    </h2>

    <form th:if="${dtopubli.esPropio and !dtopubli.esPublicidad}"
          th:action="@{/publicacion/eliminar/{id}(id=${dtopubli.id})}"
          method="post">
        <button class="delete-button" type="submit">
            <img th:src="@{/imagenes/borrarParaSiempre.png}" alt="deleteLogo" class="delete-logo"/>
        </button>
    </form>


    <p class="texto" th:if="${dtopubli.descripcion != null and !#strings.isEmpty(dtopubli.descripcion)}" th:text="${dtopubli.descripcion}"></p>

    <div th:if="${dtopubli.urlImagen != null}">
        <img th:src="@{${dtopubli.urlImagen}}"
             style="width: 100%; max-height: 400px; object-fit: cover;"
             alt="Imagen de Publicidad de IA" />
    </div>

    <div th:if="${dtopubli.archivoNombre != null and dtopubli.urlImagen == null}">
        <div th:switch="${dtopubli.archivoTipo}">
            <img th:case="'image/jpeg'" th:src="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}"
                 style="max-width: 200px; max-height: 200px;" alt="Imagen" />
            <img th:case="'image/png'" th:src="@{'/archivosPublicacion/' + ${dtopubli.archivoNombre}}"
                 style="max-width: 200px; max-height: 200px;" alt="Imagen" />

            <div th:case="'application/pdf'" class="archivo-pdf" style="margin-top: 10px;">
            </div>
        </div>
    </div>

    <span th:text="${dtopubli.fechaPublicacion != null
                        ? dtopubli.fechaPublicacion.format(T(java.time.format.DateTimeFormatter).ofPattern('dd/MM/yyyy HH:mm'))
                        : 'Sin fecha'}"></span>

    <div class="contenedor_verComentarios">
        <div th:unless="${dtopubli.esPublicidad}">
            <div class="like-container">
                <img th:src="@{/imagenes/like.png}" alt="Like" style="width:20px;" />
                <span th:text="${dtopubli.cantLikes !=null ? dtopubli.cantLikes : 0}" th:id="'likes-' + ${dtopubli.id}"></span>
            </div>

            <button class="botones_acciones ver-comentariosBtn"
                    type="button"
                    th:data-id="${dtopubli.id}"
                    th:text="${dtopubli.cantComentarios != null && dtopubli.cantComentarios > 0 ? dtopubli.cantComentarios + ' Comentarios' : 'No hay Comentarios'}">
            </button>
        </div>
    </div>

    <hr class="linea-divisora"/>

    <div class="botonera-publicacion" th:unless="${dtopubli.esPublicidad}">
        <section class="btns_interaccion_publicacion">
            <button class="botones_acciones likeBtn" type="button" th:data-id="${dtopubli.id}">
                <img th:src="@{/imagenes/like.png}" alt="Like" th:id="'like-img-' + ${dtopubli.id}" />
            </button>

            <button class="botones_acciones comentarBtn" type="button" th:data-id="${dtopubli.id}">
                <img th:src="@{/imagenes/comentar.png}" alt="Comentar" />
            </button>

            <div class="contenedor_comentar" th:id="'contenedor-comentar-' + ${dtopubli.id}" style="display:none;">
                <form th:id="'form-comentario-' + ${dtopubli.id}"
                      method="POST"
                      th:action="@{/publicacion/comentar/{id}(id=${dtopubli.id})}"
                      class="box_comentario formComentario">
                    <textarea name="texto" rows="3" placeholder="Escribe tu comentario..."></textarea>
                    <div class="box_publi_botones">
                        <button type="submit">Enviar</button>
                    </div>
                </form>
            </div>
        </section>
    </div>

    <div class="contenedor_comentarios"
         th:id="'contenedor-comentarios-' + ${dtopubli.id}"
         style="display: none;">
        <div th:each="comentario : ${dtopubli.comentarios != null ? dtopubli.comentarios : {}}" class="comentario">
            <strong th:text="${comentario.nombreUsuario + ' ' + comentario.apellidoUsuario}"></strong>
            <p th:text="${comentario.texto}"></p>
        </div>
    </div>
    <div th:unless="${dtopubli != null}">
        <p>No hay publicaciones disponibles.</p>
    </div>
</article>